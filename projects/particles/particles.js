var b=class extends Error{constructor(t){super(t),this.name="AssertionError"}};function M(s,t=""){if(!s)throw new b(t)}var r=class{x;y;width;height;constructor(t,e,i,h){this.x=t,this.y=e,this.width=i,this.height=h}includes(t){return t.x-t.width/2<=this.x+this.width/2&&t.x+t.width/2>=this.x-this.width/2&&t.y-t.height/2<=this.y+this.height/2&&t.y+t.height/2>=this.y-this.height/2}includesPoint(t,e){return t>=this.x-this.width/2&&t<=this.x+this.width/2&&e>=this.y-this.height/2&&e<=this.y+this.height/2}},p=class{quads=[];salvageQuad=null;constructor(){}get collider(){return new r(0,0,0,0)}updateTree(){this.quads[0]&&(this.salvageQuad=this.quads[0]);var t=[[this.collider.x-this.collider.width/2,this.collider.y-this.collider.height/2],[this.collider.x-this.collider.width/2,this.collider.y+this.collider.height/2],[this.collider.x+this.collider.width/2,this.collider.y-this.collider.height/2],[this.collider.x+this.collider.width/2,this.collider.y+this.collider.height/2]];for(let e of this.quads){if(!e.boundary.includes(this.collider)){e.remove(this);continue}t=t.filter(([i,h])=>!e.boundary.includesPoint(i,h))}if(t.length!=0){for(let i of this.quads)i.objects.includes(this)&&i.remove(this);let e=this.salvageQuad;for(M(e);e.depth!=0&&e.parent;)e=e.parent;e.insert(this)}}},f=class s{boundary;parent=null;depth;maxDepth;maxObjects;objects=[];divided=!1;northwest=null;northeast=null;southwest=null;southeast=null;constructor(t,e,i=0,h=4,d){this.boundary=t,this.depth=i,this.maxDepth=e,this.maxObjects=h,this.parent=d||null}insert(t){if(!this.boundary.includes(t.collider))return!1;if(this.divided)return this.northwest.insert(t),this.northeast.insert(t),this.southwest.insert(t),this.southeast.insert(t),!0;if(t.quads.push(this),this.objects.push(t),this.objects.length<=this.maxObjects||this.depth>=this.maxDepth)return!0;for(this.subdivide();this.objects.length>0;){let e=this.objects.pop();e.quads.splice(e.quads.indexOf(this),1),this.northwest.insert(e),this.northeast.insert(e),this.southwest.insert(e),this.southeast.insert(e)}return!0}remove(t){this.objects.splice(this.objects.indexOf(t),1),t.quads.splice(t.quads.indexOf(this),1),this.parent&&this.parent.trimSubdivisions()}trimSubdivisions(){let t=this.query(this.boundary);if(t.length<=this.maxObjects){this.divided=!1,this.northwest=null,this.northeast=null,this.southwest=null,this.southeast=null;for(let e of t)e.quads=e.quads.filter(i=>!i.boundary.includes(this.boundary)),this.insert(e);this.parent&&this.parent.trimSubdivisions()}}subdivide(){if(this.divided)return!1;let t=this.boundary,e=new r(t.x-t.width/4,t.y-t.height/4,t.width/2,t.height/2);this.northwest=new s(e,this.maxDepth,this.depth+1,this.maxObjects,this);let i=new r(t.x+t.width/4,t.y-t.height/4,t.width/2,t.height/2);this.northeast=new s(i,this.maxDepth,this.depth+1,this.maxObjects,this);let h=new r(t.x-t.width/4,t.y+t.height/4,t.width/2,t.height/2);this.southwest=new s(h,this.maxDepth,this.depth+1,this.maxObjects,this);let d=new r(t.x+t.width/4,t.y+t.height/4,t.width/2,t.height/2);this.southeast=new s(d,this.maxDepth,this.depth+1,this.maxObjects,this),this.divided=!0}query(t,e=[]){if(!this.boundary.includes(t))return e;if(!this.divided){for(let h of this.objects)e.includes(h)||e.push(h);return e}let i=this.northwest.query(t,e);return i=this.northeast.query(t,i),i=this.southwest.query(t,i),this.southeast.query(t,i)}};var q=document.getElementById("particles"),n=document.createElement("canvas"),m=[],l=50,a,u=[],c=[],O=500,Q=new r(globalThis.innerWidth/2,globalThis.innerHeight/2,globalThis.innerWidth+l*2,globalThis.innerHeight+l*2),y=new f(Q,4,0,10);globalThis.QT=y;globalThis.particles=m;R();function R(){q&&(q.appendChild(n),a=n.getContext("2d"),a&&requestAnimationFrame(j))}var D=0;function j(s){if(!a)return;let t=s-D;if(D=s,t<=500){let e=t/16.666666666666668;if(a.fillStyle="black",globalThis.innerWidth!==n.width||globalThis.innerHeight!==n.height)for(let o of m)o.x*=globalThis.innerWidth/n.width,o.y*=globalThis.innerHeight/n.height;for(n.width=globalThis.innerWidth,n.height=globalThis.innerHeight,a.fillRect(0,0,n.width,n.height);m.length<O;)m.push(new T);let i=performance.now(),h=performance.now();for(let o of m)o.update(e),o.lastDrawn=s,o.draw(a);c.push(performance.now()-h),c.splice(0,c.length-30);let d=c.reduce((o,x)=>o+x)/c.length;u.push(t),u.splice(0,u.length-30);let g=u.reduce((o,x)=>o+x)/u.length;a.fillStyle="white",a.font="16px serif",a.fillText(`Frame Delay: ${Math.round(g*100)/100} ms`,10,20),a.fillText(`Particle Update + Draw Delay: ${Math.round(d*100)/100} ms`,10,40),a.fillText(`FPS: ${Math.round(1e3/g*10)/10}`,10,60)}requestAnimationFrame(j)}var w=class s{x;y;constructor(t,e){this.x=t,this.y=e}get magnitude(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}setMagnitude(t){this.normalize(),this.x*=t,this.y*=t}normalize(){let t=this.magnitude;this.x/=t,this.y/=t}normalized(){let t=new s(this.x,this.y);return t.normalize(),t}subtract(t){return new s(this.x-t.x,this.y-t.y)}},T=class extends p{x;y;speed;dir;lastDrawn;constructor(){super(),this.x=Math.random()*n.width,this.y=Math.random()*n.height,this.speed=Math.random()*1.2+.2,this.dir=new w(Math.random()*2-1,Math.random()*2-1).normalized(),this.lastDrawn=0,y.insert(this)}get collider(){return new r(this.x,this.y,1,1)}draw(t){let e=160;t.strokeStyle="blue",t.fillStyle="white",t.fillRect(Math.round(this.x),Math.round(this.y),1,1);let i=new w(this.x,this.y).subtract(v).magnitude;e+=Math.max(0,100-i)/2;for(let h of y.query(new r(this.x,this.y,e*2,e*2))){if(h.lastDrawn>=this.lastDrawn)continue;let d=Math.sqrt(Math.pow(h.x-this.x,2)+Math.pow(h.y-this.y,2));if(d>e)continue;t.beginPath();let g=.4-d/400+Math.max(0,(200-i)/500);t.strokeStyle=`rgba(255, 255, 255, ${g})`,t.moveTo(Math.round(this.x),Math.round(this.y)),t.lineTo(Math.round(h.x),Math.round(h.y)),t.stroke()}}update(t){this.dir.setMagnitude(this.speed),this.x+=this.dir.x*t,this.y+=this.dir.y*t,(this.x<-l||this.x>n.width+l)&&(this.x=Math.min(n.width+l,Math.max(-l,this.x)),this.dir.x*=-1),(this.y<-l||this.y>n.height+l)&&(this.y=Math.min(n.height+l,Math.max(-l,this.y)),this.dir.y*=-1),super.updateTree()}};var v=new w(0,0);document.onmousemove=s=>{v.x=s.clientX,v.y=s.clientY};
//# sourceMappingURL=particles.js.map